<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Harmonic Tension Experiment</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- local style -->
  <link href="./style.css" rel="stylesheet">

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- DataTables Core -->
  <link href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" rel="stylesheet">
  <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

  <!-- DataTables Responsive Extension -->
  <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.9/css/responsive.dataTables.min.css">
  <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>

  <!-- Bootstrap Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    body { padding: 20px; }
    .hidden { display: none; }
    .form-control, .form-select { width: 50%; }
    .button-group { display: flex; gap: 10px; margin-top: 20px; }
    #progressBar { height: 45px; font-size: 16px; line-height: 45px; }
    .slider-labels { display: flex; justify-content: space-between; margin: 0 10px; }
  </style>
</head>

<body>
<div class="container">

  <div class="progress mb-4">
    <div id="progressBar" class="progress-bar bg-success" role="progressbar" style="width: 20%; height: auto;">Step 1 of 5</div>
  </div>

  <button id="viewResultsProtected" class="btn btn-warning mb-4">Peržiūrėti Rezultatus (Administratoriui)</button>

  <!-- STAGE 1: Description and Instructions -->
  <div id="stage1">
    <h2>Harmoninės Įtampos Eksperimentas</h2>

    <h4>Aprašymas</h4>
<p>Sveiki,</p>
<p>esu Aušrinė Butvydaitė, muzikos tyrimų bakalauro trečio kurso studentė Lietuvos muzikos ir teatro akademijoje. Šiuo metu rašau kursinį darbą „Harmoninės įtampos fenomenas: sąvokos kontūrai skirtinguose teoriniuose modeliuose“ ir atlieku akustinį eksperimentą. Jo tikslas – išsiaiškinti kaip klausytojai suvokia įtampą pateiktoje muzikinio kūrinio ištraukoje (muzikinės ištraukos trukmė 1 min.). Prieš tai bus pateiktas bandomasis testas.</p>
<p>Pradžioje Jums bus pateiktas klausimynas su 10 uždarų klausimų (klausimyno pildymo laikas maždaug 2-3 min.). Po šio klausimyno Jūs būsite perkelta/s į bandomąjį akustinį eksperimentą.</p>
<p>Jūsų duomenys yra anoniminiai ir viešai neskelbiami. Jūsų dalyvavimas yra vertingas ir padės tobulinti mokslinio tyrimo rezultatus.</p>
<h4>Instrukcija akustiniam eksperimentui</h4>
<p>Pradžioje Jums bus pateiktas bandomasis testas. Jame galite išbandyti kaip veikia pats akustinis eksperimentas.</p>
<p>Atsidarę langą matysite muzikinio kūrinio ištrauką, kurią galite paleisti, reguliuoti jos garsumą. Apačioje matysite liniją su mėlynu apskritimu. Skambant muzikai, slinkite mėlyną apskritimą ant linijos į kairę arba į dešinę pusę. Kairė pusė reiškia „mažiausia įtampa“, o dešinė pusė – „didžiausia įtampa“. Jūsų tikslas – realiu laiku reaguoti į skambančią muziką ir slankioti mėlyną apskritimą pagal juntamą muzikinę įtampą. Bandomojo testo metu jums bus pateiktos 3 akordų sekos skirtingose tonacijose su baltojo triukšmo intarpais.</p>
<p>Kai baigsite bandomąjį testą, galėsite pereiti į antrąjį langą, kuriame bus akustiniam eksperimentui skirtas kūrinys (jo trukmė apie 1 min.). Kai baigsite užduotį, Jūsų lauks paskutinis klausimas: ar esate girdėjęs/-usi šią muzikinę ištrauką anksčiau? Jei ne, palikite atsakymą tuščią.</p>
<p>Baigę visas užduotis spauskite „Finish“, kad išsisaugotų Jūsų atsakymai ir įtampos vertinimai. Jei kiltų klausimų, rašykite: ausrine.butvydaite@stud.lmta.lt.</p>
<p>Ačiū už Jūsų laiką!</p>
<div class="button-group">
      <button id="toQuestionnaire" class="btn btn-primary">Pereiti į klausimyną</button>
    </div>
  </div>

  <!-- STAGE 2: Questionnaire -->
  <div id="stage2" class="hidden">
    <h2>Klausimynas</h2>
    <form id="questionnaireForm">

        <div class="mb-3">
          <label class="form-label">1. Koks Jūsų amžius? <span class="ms-1 text-primary" data-bs-toggle="tooltip" style="cursor: help;" title="Nurodykite skaičiais.">❓</span></label>
          <input type="number" class="form-control question" required>
        </div>
        
        <div class="mb-3">
          <label class="form-label">2. Nuo kokio amžiaus pradėjote reguliariai mokytis muzikos? <span class="ms-1 text-primary" data-bs-toggle="tooltip" style="cursor: help;" title="(t.y., reguliarios muzikos pamokos arba kasdienė muzikinė praktika, trunkanti ne mažiau kaip 3 metus iš eilės).  Jei reguliariai nesimokėte muzikos, įrašykite 0.">❓</span></label>
          <input type="number" class="form-control question" required>
        </div>
        
        <div class="mb-3">
          <label class="form-label">3. Kiek metų lankėte privačias muzikos pamokas arba mokyklinius muzikinius būrelius? <span class="ms-1 text-primary" data-bs-toggle="tooltip" style="cursor: help;" title="Jei mokėtės groti daugiau nei vienu instrumentu, įskaitant dainavimą, nurodykite ilgiausiai groto instrumento/dainavimo metus. Jei niekada nelankėte privačių pamokų ar mokyklinių muzikinių būrelių, įrašykite 0.">❓</span></label>
          <input type="number" class="form-control question" required>
        </div>
        
        <div class="mb-3">
          <label class="form-label">4. Kiek metų trunka / truko jūsų reguliari kasdienė grojimo muzikos instrumentu ar dainavimo praktika? <span class="ms-1 text-primary" data-bs-toggle="tooltip" style="cursor: help;" title="Kasdieninė praktika gali būti apibrėžta kaip bent 5 kartai per savaitę. Metų laikotarpis gali būti apibrėžtas kaip 10-12 mėn.  Jeigu niekada nesipraktikavote reguliariai arba praktikavote mažiau nei 10 mėn., įrašykite 0.">❓</span></label>
          <input type="number" class="form-control question" required>
        </div>
        
        <div class="mb-3">
          <label class="form-label">5. Kiek laiko skiriate grojimui muzikos instrumentu ar dainavimui? <span class="ms-1 text-primary" data-bs-toggle="tooltip" style="cursor: help;" title="Turima omenyje ne grupinė, bet individuali praktika su mokytoju arba savarankiškai. Pasirinkite vieną labiausiai jums tinkantį atsakymą.">❓</span></label>
          <select class="form-select question" required>
            <option value="">Pasirinkite</option>
            <option value="Aš niekada neskiriu laiko grojimui ar dainavimui arba retai skiriu laiko grojimui ir dainavimui.">Aš niekada neskiriu laiko grojimui ar dainavimui arba retai skiriu laiko grojimui ir dainavimui.</option><option value="Maždaug 1 val. per mėnesį.">Maždaug 1 val. per mėnesį.</option><option value="Maždaug 1 val. per savaitę.">Maždaug 1 val. per savaitę.</option><option value="Kasdien apie 15 minučių.">Kasdien apie 15 minučių.</option><option value="Kasdien apie 1 val.">Kasdien apie 1 val.</option><option value="Kasdien daugiau nei 2 val.">Kasdien daugiau nei 2 val.</option>
          </select>
        </div>
        
        <div class="mb-3">
          <label class="form-label">6. Ar kada nors lankėte kokias nors su muzika susijusias paskaitas kolegijoje, universitete ar akademijoje? </label>
          <select class="form-select question" required>
            <option value="">Pasirinkite</option>
            <option value="Taip">Taip</option>
            <option value="Ne">Ne</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">7. Kokį muzikinį išsilavinimą esate pasiekęs?</label>
          <select class="form-select question" required>
            <option value="">Pasirinkite</option>
            <option value="Jokio.">Jokio.</option><option value="Esu baigęs/-usi muzikos mokyklą (7 metai ar 10 metų).">Esu baigęs/-usi muzikos mokyklą (7 metai ar 10 metų).</option><option value="Esu baigęs/-usi konservatoriją arba menų mokyklą.">Esu baigęs/-usi konservatoriją arba menų mokyklą.</option><option value="Esu baigęs/-usi 1 bakalauro kursą.">Esu baigęs/-usi 1 bakalauro kursą.</option><option value="Esu baigęs/-usi 2 bakalauro kursą.">Esu baigęs/-usi 2 bakalauro kursą.</option><option value="Esu baigęs/-usi 3 bakalauro kursą.">Esu baigęs/-usi 3 bakalauro kursą.</option><option value="Esu baigęs/-usi 4 bakalauro kursą.">Esu baigęs/-usi 4 bakalauro kursą.</option><option value="Esu įgijęs/-usi muzikos srities magistro arba daktaro laipsnį.">Esu įgijęs/-usi muzikos srities magistro arba daktaro laipsnį.</option>
          </select>
        </div>
        
        <div class="mb-3">
          <label class="form-label">8. Koks atsakymas geriausiai apibūdina Jūsų patirtį komponuojant/kuriant muziką?</label>
          <select class="form-select question" required>
            <option value="">Pasirinkite</option>
            <option value="Niekada nekūriau muzikos.">Niekada nekūriau muzikos.</option><option value="Esu komponavęs/-usi nedaug kūrinių, tačiau taip jų ir neužbaigęs/-usi.">Esu komponavęs/-usi nedaug kūrinių, tačiau taip jų ir neužbaigęs/-usi.</option><option value="Esu komponavęs/-usi vieną arba daugiau kūrinių, kurie pilnai užbaigti, tačiau nebuvo viešai atliekami.">Esu komponavęs/-usi vieną arba daugiau kūrinių, kurie pilnai užbaigti, tačiau nebuvo viešai atliekami.</option><option value="Esu sukūręs/-usi kūrinius, kurie buvo atlikti viešai auditorijai.">Esu sukūręs/-usi kūrinius, kurie buvo atlikti viešai auditorijai.</option><option value="Esu sukūręs/-usi kūrinius, kurie buvo atlikti regioniniu, tarptautiniu mastu (pvz., atliko regioniniu, tarptautiniu mastu žinomas atlikėjas, kolektyvas, ansamblis, orkestras.).">Esu sukūręs/-usi kūrinius, kurie buvo atlikti regioniniu, tarptautiniu mastu (pvz., atliko regioniniu, tarptautiniu mastu žinomas atlikėjas, kolektyvas, ansamblis, orkestras.).</option>
          </select>
        </div>
        
        <div class="mb-3">
          <label class="form-label">9. Kiek gyvo garso koncertų aplankėte per pastaruosius 12 mėnesių? Gali būti bet kokio žanro koncertai.</label>
          <select class="form-select question" required>
            <option value="">Pasirinkite</option>
            <option value="Iš viso neapsilankiau.">Iš viso neapsilankiau.</option>
            <option value="1 - 4 koncertai.">1 - 4 koncertai.</option>
            <option value="5 - 8 koncertai.">5 - 8 koncertai.</option>
            <option value="9 - 12 koncertai.">9 -12 koncertai.</option>
            <option value="13 ar daugiau.">13 ar daugiau.</option>
          </select>
        </div>
        
        <div class="mb-3">
          <label class="form-label">10. Kuris įvardinimas geriausiai Jus apibūdina?</label>
          <select class="form-select question" required>
            <option value="">Pasirinkite</option>
            <option value="Nesu muzikantas/-ė (žmogus, kuris neturi formalaus muzikinio išsilavinimo arba turi menką muzikinį pasiruošimą. Muziką jis/ji mėgsta kaip klausytojas, tačiau nesidomi jos praktikavimu ar muzikos teorija).">Nesu muzikantas/-ė (žmogus, kuris neturi formalaus muzikinio išsilavinimo arba turi menką muzikinį pasiruošimą. Muziką jis/ji mėgsta kaip klausytojas, tačiau nesidomi jos praktikavimu ar muzikos teorija).</option><option value="Muzikos mėgėjas/-a nemuzikantas/-ė (žmogus, kuris labai mėgsta ir domisi muzika. Jos aktyviai klausosi bei ją analizuoja, tačiau formaliai nestudijuoja muzikos ir neužsiima jos praktikavimu).">Muzikos mėgėjas/-a nemuzikantas/-ė (žmogus, kuris labai mėgsta ir domisi muzika. Jos aktyviai klausosi bei ją analizuoja, tačiau formaliai nestudijuoja muzikos ir neužsiima jos praktikavimu).</option><option value="Muzikantas/-ė mėgėjas/-a (žmogus, kuris groja arba užsiima muzika savo malonumui, bet ne dėl karjeros. Tai prilygsta asmeniniam pomėgiui).">Muzikantas/-ė mėgėjas/-a (žmogus, kuris groja arba užsiima muzika savo malonumui, bet ne dėl karjeros. Tai prilygsta asmeniniam pomėgiui).</option><option value="Pažengęs/-usi muzikantas/-ė mėgėjas/-a (žmogus, kuris daug laiko skiria muzikinei veiklai bei tobulina įgūdžius, tačiau tai ne profesinė veikla).">Pažengęs/-usi muzikantas/-ė mėgėjas/-a (žmogus, kuris daug laiko skiria muzikinei veiklai bei tobulina įgūdžius, tačiau tai ne profesinė veikla).</option><option value="Pusiau profesionalus/-i muzikantas/-ė  (žmogus, kuris formaliai studijuoja muziką arba dalinai  iš jos užsidirba pragyvenimui, tačiau tai dar ne pagrindinė profesija).">Pusiau profesionalus/-i muzikantas/-ė  (žmogus, kuris formaliai studijuoja muziką arba dalinai  iš jos užsidirba pragyvenimui, tačiau tai dar ne pagrindinė profesija).</option><option value="Profesionalus/-i muzikantas/-ė (žmogus, kurio pagrindinė profesinė veikla, susijusi su muzika).">Profesionalus/-i muzikantas/-ė (žmogus, kurio pagrindinė profesinė veikla, susijusi su muzika).</option>
          </select>
        </div>
        
      <div class="button-group">
        <button type="submit" class="btn btn-primary">Tęsti į Bandomąjį Testą</button>
        <button type="button" class="btn btn-secondary" id="backToStage1">Grįžti</button>
      </div>
    </form>
  </div>

  <div id="stage3" class="hidden">
    <h2>Pilot Test</h2>
    <p>Please listen to the example music and adjust the slider based on the tension you perceive.</p>
    <audio id="pilotAudio" controls>
      <source src="music.pilot.mp3" type="audio/mpeg">
    </audio>
    <div class="mt-3">
      <div class="slider-labels">
        <span>Low</span>
        <span>High</span>
      </div>
      <input type="range" id="pilotSlider" class="form-range" min="0" max="1" step="0.01">
    </div>
    <div class="button-group">
      <button id="toMainTest" class="btn btn-success">Proceed to Main Test</button>
      <button type="button" class="btn btn-secondary" id="backToStage2">Back</button>
    </div>
  </div>

  <!-- STAGE 4 -->
  <div id="stage4" class="hidden">
    <h2>Main Test</h2>
    <p>Listen carefully and adjust the slider to reflect the musical tension you feel.</p>
    <audio id="mainAudio" controls>
      <source src="music.mp3" type="audio/mpeg">
    </audio>
    <div class="mt-3">
      <div class="slider-labels">
        <span>Low</span>
        <span>High</span>
      </div>
      <input type="range" id="mainSlider" class="form-range" min="0" max="1" step="0.01">
    </div>
    <div class="mt-4">
      <label for="heardBefore" class="form-label">Have you heard this piece of music before?</label>
      <select id="heardBefore" class="form-select" required>
        <option value="">--Please choose an option--</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
      </select>
    </div>
    <div class="button-group">
      <button id="finishButton" class="btn btn-primary">Finish</button>
      <button type="button" class="btn btn-secondary" id="backToStage3">Back</button>
    </div>
  </div>

  <!-- STAGE 5 -->
  <div id="stage5" class="hidden">
    <h2>Thank You!</h2>
    <p>Thank you for your participation!</p>
    <p>If you are interested in the results of the survey, please email: <strong>ausrine.butvydaite@stud.lmta.lt</strong></p>
  </div>

  <!-- RESULTS PAGE -->
  <div id="resultsPage" class="hidden">
    <h2>Experiment Results</h2>

      <table id="resultsTable" class="display nowrap" style="width:100%">
        <thead>
          <tr>
            <th>Question 1</th>
            <th>Question 2</th>
            <th>Question 3</th>
            <th>Question 4</th>
            <th>Question 5</th>
            <th>Question 6</th>
            <th>Question 7</th>
            <th>Question 8</th>
            <th>Main Tension Data</th>
            <th>Heard Before</th>
            <th>Timestamp</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

    <button id="downloadCSVWindows" class="btn btn-secondary mt-3">Download CSV (Windows - UTF-8, Semicolon)</button>
    <button id="downloadCSVMac" class="btn btn-secondary mt-3">Download CSV (Mac - UTF-8, Comma)</button>
    <button id="backButtonResults" class="btn btn-primary mt-3">Back</button>
  </div>

</div>

<script>
let mainTensionData = [];
let questionnaireAnswers = [];
let mainInterval = null;
const allowRetake = true;

// Prevent retake
if (!allowRetake && localStorage.getItem("testCompleted") === "true") {
    document.body.innerHTML = "<h2>Thank you, you have already participated.</h2>";
}

// Progress bar updater
function updateProgress(step) {
    let percent = step * 20;
    $("#progressBar").css("width", percent + "%");
    $("#progressBar").text(`Step ${step} of 5`);
}

// Navigation between stages
$("#toQuestionnaire").click(() => {
    $("#stage1").addClass("hidden");
    $("#stage2").removeClass("hidden");
    updateProgress(2);
});

$("#questionnaireForm").submit(function(event) {
    event.preventDefault();
    questionnaireAnswers = [];
    $('.question').each(function() {
        questionnaireAnswers.push($(this).val());
    });
    $("#stage2").addClass("hidden");
    $("#stage3").removeClass("hidden");
    updateProgress(3);
});

$("#toMainTest").click(() => {
    document.getElementById("pilotAudio").pause();  // Stop pilot audio
    $("#stage3").addClass("hidden");
    $("#stage4").removeClass("hidden");
    updateProgress(4);
});

$("#finishButton").click(() => {
    const heardBefore = $("#heardBefore").val();
    if (!heardBefore) {
        alert("Please answer if you have heard the piece before.");
        return;
    }
    document.getElementById("mainAudio").pause();  // Stop main audio
    clearInterval(mainInterval);

    // Save to server (only questionnaire + main tension + heardBefore)
    $.ajax({
        url: "https://misc.lmta.lt/tension/server/save-results",
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify({
            questionnaireAnswers: questionnaireAnswers,
            mainTensionData: mainTensionData,
            heardBefore: heardBefore
        }),
        success: function() {
            localStorage.setItem("testCompleted", "true");
            $("#stage4").addClass("hidden");
            $("#stage5").removeClass("hidden");
            updateProgress(5);
        },
        error: function(err) {
            console.error("Error saving results:", err);
            alert("Error saving your results. Please try again.");
        }
    });
});

// Back buttons
$("#backToStage1").click(() => {
    $("#stage2").addClass("hidden");
    $("#stage1").removeClass("hidden");
    updateProgress(1);
});
$("#backToStage2").click(() => {
    $("#stage3").addClass("hidden");
    $("#stage2").removeClass("hidden");
    updateProgress(2);
});
$("#backToStage3").click(() => {
    $("#stage4").addClass("hidden");
    $("#stage3").removeClass("hidden");
    updateProgress(3);
});
$("#backButtonResults").click(() => {
    $("#resultsPage").addClass("hidden");
    $("#stage1").removeClass("hidden");
    updateProgress(1);
});

// Collect main tension every 500ms
$("#mainAudio").on("play", () => {
    mainTensionData = [];
    mainInterval = setInterval(() => {
        mainTensionData.push($("#mainSlider").val());
    }, 500);
});
$("#mainAudio").on("ended", () => {
    clearInterval(mainInterval);
});

// View results protected by password
$("#viewResultsProtected").click(() => {
    const password = prompt("Enter password:");
    if (password === "lmta") {
        $("#stage1, #stage2, #stage3, #stage4, #stage5").addClass("hidden");
        $("#resultsPage").removeClass("hidden");

        $.ajax({
            url: "https://misc.lmta.lt/tension/server/get-results",
            type: "GET",
            cache: false,
            headers: { "Cache-Control": "no-cache, no-store, must-revalidate" },
            success: function(data) {
                if (!Array.isArray(data) || data.length === 0) {
                    alert("No results found.");
                    return;
                }

                // Dynamically determine columns from the first result
                const firstEntry = data[0];
                const columnKeys = Object.keys(firstEntry);
                const columnHeaders = columnKeys.map(key => `<th>${key}</th>`).join("");

                // Inject dynamic headers into the table
                $("#resultsTable thead").html(`<tr>${columnHeaders}</tr>`);

                // Initialize DataTable
                let table = $('#resultsTable').DataTable({
                    destroy: true,
                    responsive: true
                });
                table.clear();

                // Add each row
                data.forEach(entry => {
                    const row = columnKeys.map(key => {
                        let value = entry[key];
                        if (Array.isArray(value)) {
                            return value.join(", ");
                        }
                        return value || "";
                    });
                    table.row.add(row).draw();
                });
            },
            error: function(err) {
                console.error("Error loading results:", err);
                alert("Error loading results. Please try again.");
            }
        });
    } else {
        alert("Incorrect password.");
    }
});

// Download CSV
// Windows version (UTF-8 with BOM + Semicolon separator)
$("#downloadCSVWindows").click(() => {
    $.ajax({
        url: "/tension/server/get-results",
        type: "GET",
        cache: false,
        headers: { "Cache-Control": "no-cache, no-store, must-revalidate" },
        success: function(data) {
            let csvContent = "Question1;Question2;Question3;Question4;Question5;Question6;Question7;Question8;Main Tension Data;Heard Before;Timestamp\n";
            data.forEach(entry => {
                csvContent += `"${entry.question1 || ""}";"${entry.question2 || ""}";"${entry.question3 || ""}";"${entry.question4 || ""}";"${entry.question5 || ""}";"${entry.question6 || ""}";"${entry.question7 || ""}";"${entry.question8 || ""}";"${Array.isArray(entry.mainTensionData) ? entry.mainTensionData.join(" | ") : ""}";"${entry.heardBefore || ""}";"${entry.timestamp || ""}"\n`;
            });
            const blob = new Blob(["\ufeff" + csvContent], { type: "text/csv;charset=utf-8;" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.setAttribute("download", "experiment_results_windows.csv");
            document.body.appendChild(link);
            link.click();
        },
        error: function(err) {
            console.error("Error downloading CSV:", err);
            alert("Error downloading CSV. Please try again.");
        }
    });
});

// Mac version (UTF-8 with BOM + Comma separator)
$("#downloadCSVMac").click(() => {
    $.ajax({
        url: "/tension/server/get-results",
        type: "GET",
        cache: false,
        headers: { "Cache-Control": "no-cache, no-store, must-revalidate" },
        success: function(data) {
            let csvContent = "Question1,Question2,Question3,Question4,Question5,Question6,Question7,Question8,Main Tension Data,Heard Before,Timestamp\n";
            data.forEach(entry => {
                csvContent += `"${entry.question1 || ""}","${entry.question2 || ""}","${entry.question3 || ""}","${entry.question4 || ""}","${entry.question5 || ""}","${entry.question6 || ""}","${entry.question7 || ""}","${entry.question8 || ""}","${Array.isArray(entry.mainTensionData) ? entry.mainTensionData.join(" , ") : ""}","${entry.heardBefore || ""}","${entry.timestamp || ""}"\n`;
            });
            const blob = new Blob(["\ufeff" + csvContent], { type: "text/csv;charset=utf-8;" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.setAttribute("download", "experiment_results_mac.csv");
            document.body.appendChild(link);
            link.click();
        },
        error: function(err) {
            console.error("Error downloading CSV:", err);
            alert("Error downloading CSV. Please try again.");
        }
    });
});
</script>


<script>
document.addEventListener("DOMContentLoaded", function () {
  const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  tooltipTriggerList.forEach(function (tooltipTriggerEl) {
    new bootstrap.Tooltip(tooltipTriggerEl);
  });
});
</script>

</body>
</html>